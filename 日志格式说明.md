# Log4j2 æ—¥å¿—æ ¼å¼è¯´æ˜

## ğŸ¯ å½“å‰æ—¥å¿—æ ¼å¼

```
%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%C{1}:%M:%L] - %msg%n
```

## ğŸ“ æ ¼å¼è§£æ

### ç¤ºä¾‹æ—¥å¿—è¾“å‡º

```
2025-12-30 18:30:45.123 [http-nio-8080-exec-1] INFO  com.prospect.giraffe.material.service.ImageDownloadService [ImageDownloadService:downloadImages:52] - å¼€å§‹ä¸‹è½½å›¾ç‰‡ï¼ŒURL: https://example.com/photos
```

### å„éƒ¨åˆ†è¯´æ˜

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `%d{yyyy-MM-dd HH:mm:ss.SSS}` | æ—¥æœŸæ—¶é—´ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ | `2025-12-30 18:30:45.123` |
| `[%thread]` | çº¿ç¨‹å | `[http-nio-8080-exec-1]` |
| `%-5level` | æ—¥å¿—çº§åˆ«ï¼ˆå·¦å¯¹é½ï¼Œ5ä¸ªå­—ç¬¦å®½åº¦ï¼‰ | `INFO `, `DEBUG`, `ERROR` |
| `%logger{36}` | Loggeråç§°ï¼ˆæœ€å¤š36ä¸ªå­—ç¬¦ï¼‰ | `c.p.g.m.s.ImageDownloadService` |
| `[%C{1}:%M:%L]` | **ç±»å:æ–¹æ³•å:è¡Œå·** | `[ImageDownloadService:downloadImages:52]` |
| `%msg` | æ—¥å¿—æ¶ˆæ¯å†…å®¹ | `å¼€å§‹ä¸‹è½½å›¾ç‰‡ï¼ŒURL: ...` |
| `%n` | æ¢è¡Œç¬¦ | ï¼ˆæ¢è¡Œï¼‰ |

## ğŸ” å ä½ç¬¦è¯¦è§£

### ä½ç½®ä¿¡æ¯å ä½ç¬¦

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `%C` æˆ– `%class` | å®Œæ•´ç±»å | `com.prospect.giraffe.material.service.ImageDownloadService` |
| `%C{1}` | ç®€çŸ­ç±»åï¼ˆåªæ˜¾ç¤ºç±»åï¼‰ | `ImageDownloadService` |
| `%C{2}` | æ˜¾ç¤ºä¸¤å±‚ï¼ˆåŒ…å+ç±»åï¼‰ | `service.ImageDownloadService` |
| `%M` æˆ– `%method` | æ–¹æ³•å | `downloadImages` |
| `%L` æˆ– `%line` | è¡Œå· | `52` |
| `%F` æˆ– `%file` | æ–‡ä»¶å | `ImageDownloadService.java` |

### å…¶ä»–å¸¸ç”¨å ä½ç¬¦

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `%p` æˆ– `%level` | æ—¥å¿—çº§åˆ« | `INFO`, `DEBUG`, `ERROR` |
| `%-5level` | å·¦å¯¹é½ï¼Œ5å­—ç¬¦å®½åº¦ | `INFO `, `DEBUG` |
| `%t` æˆ– `%thread` | çº¿ç¨‹å | `main`, `http-nio-8080-exec-1` |
| `%logger` | Loggeråç§°ï¼ˆå®Œæ•´ï¼‰ | `com.prospect.giraffe.material.service.ImageDownloadService` |
| `%logger{36}` | Loggeråç§°ï¼ˆç¼©å†™ï¼Œæœ€å¤š36å­—ç¬¦ï¼‰ | `c.p.g.m.s.ImageDownloadService` |
| `%msg` æˆ– `%m` | æ—¥å¿—æ¶ˆæ¯ | å®é™…çš„æ—¥å¿—å†…å®¹ |
| `%n` | æ¢è¡Œç¬¦ | - |
| `%throwable` æˆ– `%ex` | å¼‚å¸¸å †æ ˆ | å¼‚å¸¸ä¿¡æ¯ |

## ğŸ¨ å…¶ä»–æ ¼å¼é€‰é¡¹

### æ ¼å¼ 1ï¼šç®€æ´ç‰ˆï¼ˆå½“å‰ä½¿ç”¨ï¼‰

```xml
<Property name="LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%C{1}:%M:%L] - %msg%n</Property>
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
2025-12-30 18:30:45.123 [main] INFO  c.p.g.m.s.ImageDownloadService [ImageDownloadService:downloadImages:52] - å¼€å§‹ä¸‹è½½å›¾ç‰‡
```

---

### æ ¼å¼ 2ï¼šè¯¦ç»†ç‰ˆï¼ˆå«æ–‡ä»¶åï¼‰

```xml
<Property name="LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%F:%L] %M() - %msg%n</Property>
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
2025-12-30 18:30:45.123 [main] INFO  c.p.g.m.s.ImageDownloadService [ImageDownloadService.java:52] downloadImages() - å¼€å§‹ä¸‹è½½å›¾ç‰‡
```

---

### æ ¼å¼ 3ï¼šè¶…è¯¦ç»†ç‰ˆ

```xml
<Property name="LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%C.%M(%F:%L)] - %msg%n</Property>
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
2025-12-30 18:30:45.123 [main] INFO  [com.prospect.giraffe.material.service.ImageDownloadService.downloadImages(ImageDownloadService.java:52)] - å¼€å§‹ä¸‹è½½å›¾ç‰‡
```

---

### æ ¼å¼ 4ï¼šæç®€ç‰ˆï¼ˆä¸å«ä½ç½®ä¿¡æ¯ï¼‰

```xml
<Property name="LOG_PATTERN">%d{HH:mm:ss.SSS} %-5level %logger{36} - %msg%n</Property>
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
18:30:45.123 INFO  c.p.g.m.s.ImageDownloadService - å¼€å§‹ä¸‹è½½å›¾ç‰‡
```

---

### æ ¼å¼ 5ï¼šå½©è‰²æ§åˆ¶å°ï¼ˆä»…æ§åˆ¶å°ï¼‰

```xml
<Property name="CONSOLE_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight{%-5level}{FATAL=red, ERROR=red, WARN=yellow, INFO=green, DEBUG=cyan, TRACE=blue} %style{%logger{36}}{cyan} [%style{%C{1}:%M:%L}{magenta}] - %msg%n</Property>
```

---

## ğŸ”§ å¦‚ä½•ä¿®æ”¹æ—¥å¿—æ ¼å¼

### æ–¹æ³• 1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `src/main/resources/log4j2.xml`ï¼š

```xml
<Properties>
    <!-- ä¿®æ”¹è¿™ä¸€è¡Œ -->
    <Property name="LOG_PATTERN">ä½ çš„æ ¼å¼</Property>
</Properties>
```

### æ–¹æ³• 2ï¼šé’ˆå¯¹ä¸åŒè¾“å‡ºä½¿ç”¨ä¸åŒæ ¼å¼

```xml
<Properties>
    <!-- æ§åˆ¶å°æ ¼å¼ï¼ˆè¯¦ç»†ï¼‰ -->
    <Property name="CONSOLE_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%C{1}:%M:%L] - %msg%n</Property>
    
    <!-- æ–‡ä»¶æ ¼å¼ï¼ˆç®€æ´ï¼‰ -->
    <Property name="FILE_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%C{1}:%L] - %msg%n</Property>
</Properties>

<Appenders>
    <Console name="Console" target="SYSTEM_OUT">
        <PatternLayout pattern="${CONSOLE_PATTERN}"/>
    </Console>
    
    <RollingFile name="RollingFileAll" fileName="${LOG_PATH}/${APP_NAME}.log">
        <PatternLayout pattern="${FILE_PATTERN}"/>
        ...
    </RollingFile>
</Appenders>
```

---

## âš ï¸ æ€§èƒ½æç¤º

### ä½ç½®ä¿¡æ¯æ€§èƒ½å½±å“

ä»¥ä¸‹å ä½ç¬¦ä¼šå½±å“æ€§èƒ½ï¼ˆéœ€è¦è·å–è°ƒç”¨æ ˆä¿¡æ¯ï¼‰ï¼š
- âŒ `%C` (ç±»å)
- âŒ `%M` (æ–¹æ³•å)
- âŒ `%L` (è¡Œå·)
- âŒ `%F` (æ–‡ä»¶å)

**æ€§èƒ½å»ºè®®ï¼š**
1. **å¼€å‘ç¯å¢ƒ**ï¼šå¯ä»¥ä½¿ç”¨æ‰€æœ‰å ä½ç¬¦ï¼Œä¾¿äºè°ƒè¯•
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¦‚æœå¯¹æ€§èƒ½è¦æ±‚æé«˜ï¼Œè€ƒè™‘ç§»é™¤ä½ç½®ä¿¡æ¯
3. **æŠ˜ä¸­æ–¹æ¡ˆ**ï¼šåªåœ¨æ§åˆ¶å°ä½¿ç”¨è¯¦ç»†æ ¼å¼ï¼Œæ–‡ä»¶æ—¥å¿—ä½¿ç”¨ç®€æ´æ ¼å¼

### æ€§èƒ½ä¼˜åŒ–é…ç½®ç¤ºä¾‹

```xml
<Properties>
    <!-- å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†ä¿¡æ¯ -->
    <Property name="DEV_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%C{1}:%M:%L] - %msg%n</Property>
    
    <!-- ç”Ÿäº§ç¯å¢ƒï¼šæ— ä½ç½®ä¿¡æ¯ -->
    <Property name="PROD_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</Property>
</Properties>
```

---

## ğŸ“Š å®é™…æ—¥å¿—ç¤ºä¾‹

### æ­£å¸¸æ—¥å¿—

```
2025-12-30 18:30:45.123 [http-nio-8080-exec-1] INFO  c.p.g.m.s.ImageDownloadService [ImageDownloadService:downloadImages:52] - å¼€å§‹ä¸‹è½½å›¾ç‰‡ï¼ŒURL: https://example.com/photos
2025-12-30 18:30:45.456 [http-nio-8080-exec-1] DEBUG c.p.g.m.s.ImageDownloadService [ImageDownloadService:parseImageUrls:130] - ä»é¡µé¢ä¸­æå–åˆ° 50 ä¸ªå›¾ç‰‡URL
2025-12-30 18:30:48.789 [http-nio-8080-exec-1] INFO  c.p.g.m.s.ImageDownloadService [ImageDownloadService:downloadImages:95] - ä¸‹è½½å®Œæˆï¼Œæ€»æ•°: 50, æˆåŠŸ: 48, å¤±è´¥: 2
```

### é”™è¯¯æ—¥å¿—ï¼ˆåŒ…å«å †æ ˆï¼‰

```
2025-12-30 18:30:50.123 [http-nio-8080-exec-2] ERROR c.p.g.m.s.ImageDownloadService [ImageDownloadService:downloadSingleImage:236] - ä¸‹è½½å¤±è´¥: https://example.com/image.jpg, é”™è¯¯: Connection timeout
java.net.SocketTimeoutException: Read timed out
    at java.net.SocketInputStream.socketRead0(Native Method)
    at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
    at com.prospect.giraffe.material.service.ImageDownloadService.downloadSingleImage(ImageDownloadService.java:236)
    ...
```

---

## ğŸ¯ æ¨èé…ç½®

### å½“å‰æ¨èï¼ˆå·²é…ç½®ï¼‰

é€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œåœ¨è¯¦ç»†ç¨‹åº¦å’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ï¼š

```xml
<Property name="LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%C{1}:%M:%L] - %msg%n</Property>
```

**ä¼˜ç‚¹ï¼š**
- âœ… åŒ…å«ç±»åã€æ–¹æ³•åã€è¡Œå·ï¼Œä¾¿äºå®šä½é—®é¢˜
- âœ… æ ¼å¼æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»
- âœ… æ€§èƒ½å½±å“å¯æ¥å—

---

## ğŸ“š å‚è€ƒèµ„æ–™

- Log4j2 å®˜æ–¹æ–‡æ¡£ï¼šhttps://logging.apache.org/log4j/2.x/manual/layouts.html
- Pattern Layoutï¼šhttps://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout

