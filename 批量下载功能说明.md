# æ‰¹é‡ä¸‹è½½åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æ”¯æŒä¸€æ¬¡æ€§ä¸‹è½½å¤šä¸ªé¡µé¢çš„å›¾ç‰‡ï¼Œå¯ä»¥å¹¶å‘æˆ–ä¸²è¡Œæ‰§è¡Œï¼Œæé«˜ä¸‹è½½æ•ˆç‡ã€‚

---

## ğŸ“‹ API æ¥å£

### æ‰¹é‡ä¸‹è½½æ¥å£

**æ¥å£åœ°å€ï¼š** `POST /api/v1/download/images/batch`

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "urls": [
    "https://movie.douban.com/photos/photo/1234567890/",
    "https://movie.douban.com/photos/photo/1234567891/",
    "https://movie.douban.com/photos/photo/1234567892/"
  ],
  "targetDir": "batch_downloads",
  "convertToJpeg": true,
  "crawlAllPages": false,
  "concurrent": true,
  "maxConcurrency": 3
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "code": 200,
  "message": "æ‰¹é‡ä¸‹è½½å®Œæˆ",
  "data": {
    "success": true,
    "message": "æ‰€æœ‰é¡µé¢ä¸‹è½½å®Œæˆ",
    "totalPages": 3,
    "successPages": 3,
    "failPages": 0,
    "totalImages": 150,
    "successImages": 145,
    "failImages": 5,
    "totalDuration": 125000,
    "pageResults": [
      {
        "url": "https://movie.douban.com/photos/photo/1234567890/",
        "success": true,
        "message": "ä¸‹è½½å®Œæˆ",
        "totalCount": 50,
        "successCount": 48,
        "failCount": 2,
        "savePath": "./downloads/batch_downloads/20251230_180000",
        "failedUrls": ["https://example.com/image1.jpg", "https://example.com/image2.jpg"],
        "duration": 45000,
        "watermarkStats": null
      },
      {
        "url": "https://movie.douban.com/photos/photo/1234567891/",
        "success": true,
        "message": "ä¸‹è½½å®Œæˆ",
        "totalCount": 50,
        "successCount": 50,
        "failCount": 0,
        "savePath": "./downloads/batch_downloads/20251230_180000",
        "failedUrls": [],
        "duration": 40000,
        "watermarkStats": null
      },
      {
        "url": "https://movie.douban.com/photos/photo/1234567892/",
        "success": true,
        "message": "ä¸‹è½½å®Œæˆ",
        "totalCount": 50,
        "successCount": 47,
        "failCount": 3,
        "savePath": "./downloads/batch_downloads/20251230_180000",
        "failedUrls": ["https://example.com/image3.jpg"],
        "duration": 40000,
        "watermarkStats": null
      }
    ]
  }
}
```

---

## ğŸ”§ è¯·æ±‚å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| **urls** | `List<String>` | âœ… | - | é¡µé¢URLåˆ—è¡¨ï¼ˆè‡³å°‘1ä¸ªï¼‰ |
| **targetDir** | `String` | âŒ | - | ç›®æ ‡ç›®å½•ï¼ˆç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼‰ |
| **savePath** | `String` | âŒ | - | å®Œæ•´ä¿å­˜è·¯å¾„ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ |
| **useTimestamp** | `Boolean` | âŒ | `true` | æ˜¯å¦æ·»åŠ æ—¶é—´æˆ³å­ç›®å½• |
| **timestampFormat** | `String` | âŒ | `yyyyMMdd_HHmmss` | æ—¶é—´æˆ³æ ¼å¼ |
| **convertToJpeg** | `Boolean` | âŒ | `true` | æ˜¯å¦è½¬æ¢ä¸ºJPEGæ ¼å¼ |
| **crawlAllPages** | `Boolean` | âŒ | `false` | æ˜¯å¦è‡ªåŠ¨çˆ¬å–æ‰€æœ‰åˆ†é¡µ |
| **maxPages** | `Integer` | âŒ | `50` | æœ€å¤§çˆ¬å–é¡µæ•° |
| **removeWatermark** | `Boolean` | âŒ | `false` | æ˜¯å¦å»é™¤æ°´å° |
| **watermarkProvider** | `String` | âŒ | - | æ°´å°å»é™¤æœåŠ¡å•†ï¼ˆaliyun/tencent/baiduï¼‰ |
| **saveOriginal** | `Boolean` | âŒ | - | æ˜¯å¦ä¿å­˜åŸå›¾ |
| **concurrent** | `Boolean` | âŒ | `true` | æ˜¯å¦å¹¶å‘ä¸‹è½½ |
| **maxConcurrency** | `Integer` | âŒ | `3` | æœ€å¤§å¹¶å‘æ•°ï¼ˆä»…åœ¨concurrent=trueæ—¶ç”Ÿæ•ˆï¼‰ |

---

## ğŸš€ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå¹¶å‘ä¸‹è½½å¤šä¸ªé¡µé¢ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** ç½‘ç»œç¨³å®šï¼Œéœ€è¦å¿«é€Ÿä¸‹è½½å¤šä¸ªé¡µé¢

```json
{
  "urls": [
    "https://movie.douban.com/photos/photo/1234567890/",
    "https://movie.douban.com/photos/photo/1234567891/",
    "https://movie.douban.com/photos/photo/1234567892/"
  ],
  "concurrent": true,
  "maxConcurrency": 3
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… ä¸‹è½½é€Ÿåº¦å¿«
- âœ… å……åˆ†åˆ©ç”¨ç½‘ç»œèµ„æº

**ç¼ºç‚¹ï¼š**
- âš ï¸ å¯èƒ½å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›
- âš ï¸ å¤±è´¥ç‡å¯èƒ½ç•¥é«˜

---

### åœºæ™¯2ï¼šä¸²è¡Œä¸‹è½½å¤šä¸ªé¡µé¢

**é€‚ç”¨åœºæ™¯ï¼š** ç½‘ç»œä¸ç¨³å®šï¼Œæˆ–éœ€è¦é¿å…è¢«é™æµ

```json
{
  "urls": [
    "https://movie.douban.com/photos/photo/1234567890/",
    "https://movie.douban.com/photos/photo/1234567891/",
    "https://movie.douban.com/photos/photo/1234567892/"
  ],
  "concurrent": false
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… æ›´ç¨³å®šï¼Œå¤±è´¥ç‡ä½
- âœ… é¿å…è¢«é™æµ

**ç¼ºç‚¹ï¼š**
- âš ï¸ ä¸‹è½½é€Ÿåº¦è¾ƒæ…¢

---

### åœºæ™¯3ï¼šæ‰¹é‡ä¸‹è½½å¹¶çˆ¬å–æ‰€æœ‰åˆ†é¡µ

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦ä¸‹è½½æ¯ä¸ªé¡µé¢çš„æ‰€æœ‰åˆ†é¡µå›¾ç‰‡

```json
{
  "urls": [
    "https://movie.douban.com/photos/photo/1234567890/",
    "https://movie.douban.com/photos/photo/1234567891/"
  ],
  "crawlAllPages": true,
  "maxPages": 10,
  "concurrent": true,
  "maxConcurrency": 2
}
```

**æ³¨æ„ï¼š**
- âš ï¸ æ¯ä¸ªé¡µé¢éƒ½ä¼šçˆ¬å–æ‰€æœ‰åˆ†é¡µï¼Œæ€»å›¾ç‰‡æ•°å¯èƒ½å¾ˆå¤§
- âš ï¸ å»ºè®®é™ä½å¹¶å‘æ•°ï¼Œé¿å…èµ„æºè€—å°½

---

### åœºæ™¯4ï¼šæ‰¹é‡ä¸‹è½½å¹¶å»é™¤æ°´å°

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦æ‰¹é‡å¤„ç†å¹¶å»é™¤æ°´å°

```json
{
  "urls": [
    "https://movie.douban.com/photos/photo/1234567890/",
    "https://movie.douban.com/photos/photo/1234567891/"
  ],
  "removeWatermark": true,
  "watermarkProvider": "aliyun",
  "saveOriginal": true,
  "concurrent": false
}
```

**æ³¨æ„ï¼š**
- âš ï¸ æ°´å°å»é™¤éœ€è¦è°ƒç”¨äº‘æœåŠ¡APIï¼Œå»ºè®®ä¸²è¡Œä¸‹è½½
- âš ï¸ æ³¨æ„äº‘æœåŠ¡çš„å…è´¹é¢åº¦é™åˆ¶

---

## ğŸ“Š å“åº”ç»“æœè¯´æ˜

### æ•´ä½“ç»Ÿè®¡

| å­—æ®µ | è¯´æ˜ |
|------|------|
| **success** | æ˜¯å¦æ‰€æœ‰é¡µé¢éƒ½æˆåŠŸ |
| **totalPages** | æ€»é¡µé¢æ•° |
| **successPages** | æˆåŠŸé¡µé¢æ•° |
| **failPages** | å¤±è´¥é¡µé¢æ•° |
| **totalImages** | æ€»å›¾ç‰‡æ•°ï¼ˆæ‰€æœ‰é¡µé¢ï¼‰ |
| **successImages** | æˆåŠŸä¸‹è½½å›¾ç‰‡æ•° |
| **failImages** | å¤±è´¥å›¾ç‰‡æ•° |
| **totalDuration** | æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰ |

### å•ä¸ªé¡µé¢ç»“æœ

| å­—æ®µ | è¯´æ˜ |
|------|------|
| **url** | é¡µé¢URL |
| **success** | è¯¥é¡µé¢æ˜¯å¦æˆåŠŸ |
| **totalCount** | è¯¥é¡µé¢çš„å›¾ç‰‡æ€»æ•° |
| **successCount** | è¯¥é¡µé¢çš„æˆåŠŸæ•° |
| **failCount** | è¯¥é¡µé¢çš„å¤±è´¥æ•° |
| **savePath** | ä¿å­˜è·¯å¾„ |
| **failedUrls** | å¤±è´¥çš„å›¾ç‰‡URLåˆ—è¡¨ |
| **duration** | è¯¥é¡µé¢çš„è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰ |

---

## âš™ï¸ å¹¶å‘æ§åˆ¶

### å¹¶å‘æ¨¡å¼

- **å¹¶å‘æ•°æ§åˆ¶ï¼š** ä½¿ç”¨çº¿ç¨‹æ± ï¼Œé»˜è®¤æœ€å¤§å¹¶å‘æ•°ä¸º3
- **çº¿ç¨‹æ± ç±»å‹ï¼š** `FixedThreadPool`
- **è¶…æ—¶æ§åˆ¶ï¼š** çº¿ç¨‹æ± å…³é—­ç­‰å¾…60ç§’

### å¹¶å‘æ•°å»ºè®®

| åœºæ™¯ | å»ºè®®å¹¶å‘æ•° |
|------|-----------|
| ç½‘ç»œç¨³å®šï¼ŒæœåŠ¡å™¨æ€§èƒ½å¥½ | 5-10 |
| ç½‘ç»œä¸€èˆ¬ï¼Œéœ€è¦å¹³è¡¡ | 3-5 |
| ç½‘ç»œä¸ç¨³å®šï¼Œé¿å…é™æµ | 1-2 |
| ä¸²è¡Œæ¨¡å¼ | 1ï¼ˆä¸å¹¶å‘ï¼‰ |

---

## ğŸ” é”™è¯¯å¤„ç†

### å•ä¸ªé¡µé¢å¤±è´¥

- âœ… ä¸ä¼šå½±å“å…¶ä»–é¡µé¢çš„ä¸‹è½½
- âœ… å¤±è´¥é¡µé¢çš„ç»“æœä¼šè®°å½•åœ¨ `pageResults` ä¸­
- âœ… `success` å­—æ®µä¸º `false`ï¼Œ`message` åŒ…å«é”™è¯¯ä¿¡æ¯

### æ•´ä½“ç»“æœ

- âœ… `success` å­—æ®µè¡¨ç¤ºæ˜¯å¦æ‰€æœ‰é¡µé¢éƒ½æˆåŠŸ
- âœ… `failPages > 0` æ—¶ï¼Œ`success` ä¸º `false`
- âœ… `message` å­—æ®µä¼šè¯´æ˜æˆåŠŸå’Œå¤±è´¥çš„é¡µé¢æ•°

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### cURL ç¤ºä¾‹

```bash
curl -X POST http://localhost:8080/api/v1/download/images/batch \
  -H "Content-Type: application/json" \
  -d '{
    "urls": [
      "https://movie.douban.com/photos/photo/1234567890/",
      "https://movie.douban.com/photos/photo/1234567891/"
    ],
    "targetDir": "batch_test",
    "concurrent": true,
    "maxConcurrency": 3
  }'
```

### JavaScript (Fetch) ç¤ºä¾‹

```javascript
const response = await fetch('http://localhost:8080/api/v1/download/images/batch', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    urls: [
      'https://movie.douban.com/photos/photo/1234567890/',
      'https://movie.douban.com/photos/photo/1234567891/'
    ],
    targetDir: 'batch_test',
    concurrent: true,
    maxConcurrency: 3
  })
});

const result = await response.json();
console.log('æ‰¹é‡ä¸‹è½½ç»“æœ:', result);
```

### Python ç¤ºä¾‹

```python
import requests

url = "http://localhost:8080/api/v1/download/images/batch"
data = {
    "urls": [
        "https://movie.douban.com/photos/photo/1234567890/",
        "https://movie.douban.com/photos/photo/1234567891/"
    ],
    "targetDir": "batch_test",
    "concurrent": True,
    "maxConcurrency": 3
}

response = requests.post(url, json=data)
result = response.json()
print("æ‰¹é‡ä¸‹è½½ç»“æœ:", result)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¹¶å‘æ•°é™åˆ¶

- **ä¸è¦è®¾ç½®è¿‡å¤§çš„å¹¶å‘æ•°**ï¼ˆå»ºè®® â‰¤ 10ï¼‰
- è¿‡å¤§çš„å¹¶å‘æ•°å¯èƒ½å¯¼è‡´ï¼š
  - æœåŠ¡å™¨é™æµ
  - ç½‘ç»œæ‹¥å¡
  - å†…å­˜å ç”¨è¿‡é«˜

### 2. é¡µé¢æ•°é‡é™åˆ¶

- **å»ºè®®å•æ¬¡æ‰¹é‡ä¸‹è½½çš„é¡µé¢æ•° â‰¤ 50**
- è¿‡å¤šé¡µé¢å¯èƒ½å¯¼è‡´ï¼š
  - è¯·æ±‚è¶…æ—¶
  - å†…å­˜å ç”¨è¿‡é«˜
  - ä¸‹è½½æ—¶é—´è¿‡é•¿

### 3. ç½‘ç»œç¨³å®šæ€§

- **ç½‘ç»œä¸ç¨³å®šæ—¶å»ºè®®ä½¿ç”¨ä¸²è¡Œæ¨¡å¼**
- ä¸²è¡Œæ¨¡å¼è™½ç„¶æ…¢ï¼Œä½†æ›´ç¨³å®š

### 4. èµ„æºå ç”¨

- **æ‰¹é‡ä¸‹è½½ä¼šå ç”¨è¾ƒå¤šèµ„æº**ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œï¼‰
- å»ºè®®åœ¨æœåŠ¡å™¨èµ„æºå……è¶³æ—¶ä½¿ç”¨

### 5. å¤±è´¥å¤„ç†

- **å•ä¸ªé¡µé¢å¤±è´¥ä¸å½±å“å…¶ä»–é¡µé¢**
- å»ºè®®æ£€æŸ¥ `pageResults` ä¸­çš„å¤±è´¥è¯¦æƒ…
- å¯ä»¥é’ˆå¯¹å¤±è´¥çš„é¡µé¢å•ç‹¬é‡è¯•

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šéƒ¨åˆ†é¡µé¢ä¸‹è½½å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- ç½‘ç»œä¸ç¨³å®š
- é¡µé¢URLæ— æ•ˆ
- æœåŠ¡å™¨é™æµ

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥å¤±è´¥é¡µé¢çš„URLæ˜¯å¦æœ‰æ•ˆ
2. é™ä½å¹¶å‘æ•°ï¼Œä½¿ç”¨ä¸²è¡Œæ¨¡å¼
3. å¢åŠ è¯·æ±‚é—´éš”ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼‰

### é—®é¢˜2ï¼šå¹¶å‘ä¸‹è½½æ—¶å¤±è´¥ç‡é«˜

**å¯èƒ½åŸå› ï¼š**
- å¹¶å‘æ•°è¿‡å¤§
- æœåŠ¡å™¨é™æµ

**è§£å†³æ–¹æ¡ˆï¼š**
1. é™ä½ `maxConcurrency`ï¼ˆå¦‚æ”¹ä¸º2æˆ–1ï¼‰
2. ä½¿ç”¨ä¸²è¡Œæ¨¡å¼ï¼ˆ`concurrent: false`ï¼‰

### é—®é¢˜3ï¼šä¸‹è½½é€Ÿåº¦æ…¢

**å¯èƒ½åŸå› ï¼š**
- ä½¿ç”¨ä¸²è¡Œæ¨¡å¼
- å¹¶å‘æ•°å¤ªå°
- ç½‘ç»œé€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨å¹¶å‘æ¨¡å¼ï¼ˆ`concurrent: true`ï¼‰
2. é€‚å½“å¢åŠ å¹¶å‘æ•°ï¼ˆå¦‚æ”¹ä¸º5ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸‹è½½å¤±è´¥ç‡ä¼˜åŒ–è¯´æ˜.md](./ä¸‹è½½å¤±è´¥ç‡ä¼˜åŒ–è¯´æ˜.md)
- [ä¿å­˜ç›®å½•é…ç½®è¯´æ˜.md](./ä¿å­˜ç›®å½•é…ç½®è¯´æ˜.md)
- [æ°´å°å»é™¤é…ç½®è¯´æ˜.md](./æ°´å°å»é™¤é…ç½®è¯´æ˜.md)

